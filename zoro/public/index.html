
<!DOCTYPE html>
<html>
<head>
  <title>User Page</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>#map{height:100vh;width:100%;}</style>
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>
<body>
<div id="map"></div>
<script>
const socket = io();
let map, marker;

function initMap(lat, lng){
  map = L.map('map').setView([lat,lng], 15);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
    attribution:'&copy; OpenStreetMap contributors'
  }).addTo(map);
  marker = L.marker([lat,lng]).addTo(map).bindPopup("You");
}

function updatePosition(lat,lng){
  if(marker) marker.setLatLng([lat,lng]);
  map.setView([lat,lng], map.getZoom());
  socket.emit('updateLocation',{latitude:lat,longitude:lng});
}

if(navigator.geolocation){
  navigator.geolocation.getCurrentPosition(pos=>{
    initMap(pos.coords.latitude,pos.coords.longitude);
    setInterval(()=>{
      navigator.geolocation.getCurrentPosition(p=>{
        updatePosition(p.coords.latitude,p.coords.longitude);
      },err=>console.error(err),{enableHighAccuracy:true});
    },3000);
  },err=>alert("Enable GPS and allow location."),{enableHighAccuracy:true});
}else alert("Geolocation not supported");
</script>
</body>
</html>








